<html>
<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script>

function hideAllSections() {
    $("#results").hide();
    $("#itemgroup").hide();
    $("#item").hide();
    $("#errorBox").hide();
}

function findPart() {
    loadPart($("#code").val());
}

function runQuery() {
    query($("#queryBox").val());
}

function errorFree(data) {
    if("error" in data) {
        hideAllSections();
        $("#errorBoxMsg").html(data["error"]);
        $("#errorBox").show();
        return false;
    }else{
        return true;
    }
}

function query(q) {
    $.getJSON("query?q=" + q, function(data) {
        if (errorFree(data) == false) return;

        hideAllSections();
        $("#results").show();
        $("#resultsBody").html("");

        for(item in data["results"]) {
           $("#resultsBody").append("<tr><td>"+
                                    "<a href='#code:"+data["results"][item][0]+"' onClick=\"loadPart('"+ data["results"][item] + "');\">"
                                    + data["results"][item][0] +"</a></td>"
                                    +"<td>"+ data["results"][item][1] + "</td>" 
                                    +"<td>"+ data["results"][item][2] + "</td>"
                                    +"</tr>");
        }
    });
}

function loadPart(code) {
        $.getJSON("part?q=" + code, function(data) {
        if (errorFree(data) == false) return;

        if(data["type"] == "Item") {
            hideAllSections();
            $("#item").show();

            for(var i in data) {
                if(i == "parent") {
                    $("#item_parent").html("<a href='#' onClick=\"loadPart('" + data["parent"]["code"] + "')\">" + data["parent"]["name"] + "</a>");
                }else{
                    $("#item_" + i).html(data[i]);
                }
            }
        }else if(data["type"] == "ItemGroup") {
            hideAllSections();
            $("#itemgroup").show();

            for(var i in data) {
                $("#itemgroup_" + i).html(data[i]);
            }

        }
    });
}
</script>
<style>
div
{
    border-style:solid;
    border-width:1px;
    margin: 5px;
}
</style>

</head>

<body>
    <h1>Inventory Query System</h1>

    <div>
        Part Code:
        <input type="text" id="code" value="1MM2U" />
        <input type="button" href="#" onClick="findPart()" />
    </div>

    <div>
        Enter Query:
        <input type="text" id="queryBox" value="cond:broken" />
        <input type="button" href="#" onClick="runQuery()" />
    </div>

    <div id="errorBox" style="display:none">Error: <span id="errorBoxMsg"/></span></div>

    <div id="itemgroup" style="display:none">
        Item Group Details:
        <div>Item Code: <span id="itemgroup_code"></span></div>
        <div>Item Description: <span id="itemgroup_description"></span></div>
        <div>Item Name: <span id="itemgroup_name"></span></div>
        <div>Item Path: <span id="itemgroup_path"></span></div>
    </div>

    <div id="item" style="display:none">
        Item Details:
        <div>Item Code: <span id="item_code"></span></div>
        <div>Item Condition: <span id="item_condition"></span></div>
        <div>Item Description: <span id="item_description"></span></div>
        <div>Item Labelled?: <span id="item_labelled"></span></div>
        <div>Item Name: <span id="item_name"></span></div>
        <div>Item Path: <span id="item_path"></span></div>
        <div>Item Value: <span id="item_value"></span></div>
        <div>Item Parent: <span id="item_parent"></span></div>
    </div>

    <div id="results" style="display:none">
        <table>
        <tr>
            <td>Code</td>
            <td>Name</td>
            <td>Path</td>
        </tr>
        <tbody id="resultsBody">

        </tbody>
        </table>

    </div>


<script>
page = window.location.href.split("#")[1];

if(page != undefined) {
    query(page);
}


</script>
</body>
</html>
